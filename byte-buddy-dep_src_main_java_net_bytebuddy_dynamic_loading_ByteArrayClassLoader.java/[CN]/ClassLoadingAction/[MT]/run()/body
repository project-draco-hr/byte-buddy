{
  byte[] javaType=persistenceHandler.lookup(typeName,typeDefinitions);
  if (javaType != null) {
    int packageIndex=typeName.lastIndexOf('.');
    if (packageIndex != -1) {
      String packageName=typeName.substring(0,packageIndex);
      PackageDefinitionStrategy.Definition definition=packageDefinitionStrategy.define(ByteArrayClassLoader.this,packageName,typeName);
      if (definition.isDefined()) {
        Package definedPackage=getPackage(packageName);
        if (definedPackage == null) {
          definePackage(packageName,definition.getSpecificationTitle(),definition.getSpecificationVersion(),definition.getSpecificationVendor(),definition.getImplementationTitle(),definition.getImplementationVersion(),definition.getImplementationVendor(),definition.getSealBase());
        }
 else         if (!definition.isCompatibleTo(definedPackage)) {
          throw new SecurityException("Sealing violation for package " + packageName);
        }
      }
    }
    return defineClass(typeName,javaType,FROM_BEGINNING,javaType.length,protectionDomain);
  }
  throw new ClassNotFoundException(typeName);
}
