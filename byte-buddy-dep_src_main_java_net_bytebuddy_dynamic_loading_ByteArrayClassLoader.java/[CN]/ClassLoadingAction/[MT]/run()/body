{
  byte[] javaType=persistenceHandler.lookup(typeName,typeDefinitions);
  if (javaType != null) {
    int packageIndex=typeName.lastIndexOf('.');
    if (packageIndex != -1) {
      String packageName=typeName.substring(0,packageIndex);
      PackageDefinitionStrategy.Definition definition=packageDefinitionStrategy.define(packageName,ByteArrayClassLoader.this,typeName);
      if (definition.isDefined()) {
        Package definedPackage=getPackage(packageName);
        if (definedPackage == null) {
          definePackage(packageName,definition.getSpecificationTitle(),definition.getSpecificationVersion(),definition.getSpecificationVendor(),definition.getImplementationTitle(),definition.getImplementationVersion(),definition.getImplementationVendor(),definition.getSealBase());
        }
 else {
          URL sealBase=definition.getSealBase();
          if ((sealBase == null && definedPackage.isSealed()) || (sealBase != null && !definedPackage.isSealed(sealBase))) {
            throw new SecurityException("Sealing violation for package " + packageName);
          }
        }
      }
    }
    return defineClass(typeName,javaType,FROM_BEGINNING,javaType.length,protectionDomain);
  }
  throw new ClassNotFoundException(typeName);
}
