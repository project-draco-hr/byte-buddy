{
  if (!classesRoot.isDirectory()) {
    throw new GradleException("Target location does not exist or is no directory: " + classesRoot);
  }
  ClassLoaderResolver classLoaderResolver=new ClassLoaderResolver(project);
  try {
    List<Plugin> plugins=new ArrayList<Plugin>(byteBuddyExtension.getTransformations().size());
    for (    Transformation transformation : byteBuddyExtension.getTransformations()) {
      try {
        String plugin=transformation.getPlugin();
        plugins.add((Plugin)Class.forName(plugin,false,classLoaderResolver.resolve(transformation.getClasspath())).getDeclaredConstructor().newInstance());
        logger.info("Created plugin: {}",plugin);
      }
 catch (      Exception exception) {
        throw new GradleException("Cannot create plugin: " + transformation,exception);
      }
    }
    EntryPoint entryPoint=byteBuddyExtension.getInitialization().toEntryPoint(classLoaderResolver);
    logger.info("Resolved entry point: {}",entryPoint);
    transform(classesRoot,entryPoint,compileClasspathFiles,plugins);
  }
  finally {
    classLoaderResolver.close();
  }
}
