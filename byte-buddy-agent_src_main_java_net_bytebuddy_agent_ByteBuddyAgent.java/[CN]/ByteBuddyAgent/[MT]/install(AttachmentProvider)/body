{
  Instrumentation instrumentation=doGetInstrumentation();
  if (instrumentation != null) {
    return instrumentation;
  }
  AttachmentProvider.Accessor accessor=attachmentProvider.attempt();
  if (accessor.isAvailable()) {
    try {
      doInstall(accessor);
    }
 catch (    Exception exception) {
      throw new IllegalStateException("Error during attachment using: " + attachmentProvider,exception);
    }
    return getInstrumentation();
  }
 else {
    throw new IllegalStateException("This JVM does not support attachment using: " + attachmentProvider);
  }
}
