{
  when(assignmentBinding.isValid()).thenReturn(true);
  when(methodInvocation.isValid()).thenReturn(true);
  when(termination.isValid()).thenReturn(true);
  when(targetMethod.getDeclaredAnnotations()).thenReturn(new AnnotationList.Empty());
  when(firstParameter.getDeclaredAnnotations()).thenReturn(new AnnotationList.Explicit(Collections.singletonList(secondPseudoAnnotation)));
  when(secondParameter.getDeclaredAnnotations()).thenReturn(new AnnotationList.Explicit(Collections.singletonList(firstPseudoAnnotation)));
  MethodDelegationBinder.ParameterBinding<?> firstBinding=prepareArgumentBinder(firstParameterBinder,FirstPseudoAnnotation.class,new Key(FOO),true);
  MethodDelegationBinder.ParameterBinding<?> secondBinding=prepareArgumentBinder(secondParameterBinder,SecondPseudoAnnotation.class,new Key(BAR),true);
  Iterator<AnnotationDescription> defaultsIterator=prepareDefaultProvider(defaultsProvider,Collections.<AnnotationDescription>emptyList());
  MethodDelegationBinder methodDelegationBinder=new TargetMethodAnnotationDrivenBinder(Arrays.<TargetMethodAnnotationDrivenBinder.ParameterBinder<?>>asList(firstParameterBinder,secondParameterBinder),defaultsProvider,terminationHandler,assigner,methodInvoker);
  MethodDelegationBinder.MethodBinding methodBinding=methodDelegationBinder.bind(instrumentationTarget,sourceMethod,targetMethod);
  assertThat(methodBinding.isValid(),is(true));
  assertThat(methodBinding.getTarget(),is(targetMethod));
  assertThat(methodBinding.getTargetParameterIndex(new Key(FOO)),is(1));
  assertThat(methodBinding.getTargetParameterIndex(new Key(BAR)),is(0));
  StackManipulation.Size size=methodBinding.apply(methodVisitor,instrumentationContext);
  assertThat(size.getSizeImpact(),is(0));
  assertThat(size.getMaximalSize(),is(0));
  verifyZeroInteractions(methodVisitor);
  verify(targetMethod,atLeast(1)).getDeclaredAnnotations();
  verify(firstParameter,atLeast(1)).getDeclaredAnnotations();
  verify(secondParameter,atLeast(1)).getDeclaredAnnotations();
  verifyNoMoreInteractions(assigner);
  verify(terminationHandler).resolve(assigner,sourceMethod,targetMethod);
  verifyNoMoreInteractions(terminationHandler);
  verify(methodInvoker).invoke(targetMethod);
  verifyNoMoreInteractions(methodInvoker);
  verify(firstParameterBinder,atLeast(1)).getHandledType();
  verify((TargetMethodAnnotationDrivenBinder.ParameterBinder)firstParameterBinder).bind(firstPseudoAnnotation,sourceMethod,secondParameter,instrumentationTarget,assigner);
  verifyNoMoreInteractions(firstParameterBinder);
  verify(secondParameterBinder,atLeast(1)).getHandledType();
  verify((TargetMethodAnnotationDrivenBinder.ParameterBinder)secondParameterBinder).bind(secondPseudoAnnotation,sourceMethod,firstParameter,instrumentationTarget,assigner);
  verifyNoMoreInteractions(secondParameterBinder);
  verifyZeroInteractions(defaultsIterator);
  verify(firstBinding,atLeast(1)).isValid();
  verify(firstBinding).getIdentificationToken();
  verify(secondBinding,atLeast(1)).isValid();
  verify(secondBinding).getIdentificationToken();
}
