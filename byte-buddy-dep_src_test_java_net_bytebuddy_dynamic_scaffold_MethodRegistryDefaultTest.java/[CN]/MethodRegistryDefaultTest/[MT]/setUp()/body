{
  when(fallbackFactory.compile(any(Instrumentation.Target.class))).thenReturn(fallback);
  when(latentMatchesKnownMethod.manifest(any(TypeDescription.class))).thenReturn((ElementMatcher)matchesKnownMethod);
  when(matchesKnownMethod.matches(knownMethod)).thenReturn(true);
  when(basicInstrumentedType.getDeclaredMethods()).thenReturn(basicMethodList);
  when(basicMethodList.size()).thenReturn(BASIC_SIZE);
  when(basicFinding.getInvokableMethods()).thenReturn(basicMethodList);
  when(basicInstrumentationTarget.getTypeDescription()).thenReturn(basicInstrumentedType);
  when(extendedInstrumentationTarget.getTypeDescription()).thenReturn(extendedInstrumentedType);
  when(methodLookupEngine.process(basicInstrumentedType)).thenReturn(basicFinding);
  when(methodLookupEngine.process(extendedInstrumentedType)).thenReturn(extendedFinding);
  when(instrumentationTargetFactory.make(basicFinding)).thenReturn(basicInstrumentationTarget);
  when(instrumentationTargetFactory.make(extendedFinding)).thenReturn(extendedInstrumentationTarget);
  when(extendedInstrumentedType.getDeclaredMethods()).thenReturn(extendedMethodList);
  when(extendedMethodList.size()).thenReturn(EXTENDED_SIZE);
  when(extendedFinding.getInvokableMethods()).thenReturn(extendedMethodList);
  when(extendedMethodList.subList(anyInt(),anyInt())).thenReturn(croppedMethodList);
  when(zeroSize.size()).thenReturn(0);
  when(singleSize.size()).thenReturn(1);
  when(croppedMethodList.filter(any(ElementMatcher.class))).thenAnswer(new Answer<MethodList>(){
    @Override public MethodList answer(    InvocationOnMock invocation) throws Throwable {
      Field field=invocation.getArguments()[0].getClass().getDeclaredField("value");
      field.setAccessible(true);
      return field.get(invocation.getArguments()[0]) == instrumentationAppendedMethod ? singleSize : zeroSize;
    }
  }
);
  when(simpleInstrumentation.prepare(any(InstrumentedType.class))).thenReturn(basicInstrumentedType);
  when(simpleInstrumentation.appender(any(Instrumentation.Target.class))).thenReturn(simpleByteCodeAppender);
  when(simpleAttributeAppenderFactory.make(any(InstrumentedType.class))).thenReturn(simpleAttributeAppender);
  when(otherInstrumentation.prepare(any(InstrumentedType.class))).thenReturn(basicInstrumentedType);
  when(otherInstrumentation.appender(any(Instrumentation.Target.class))).thenReturn(otherByteCodeAppender);
  when(otherAttributeAppenderFactory.make(any(InstrumentedType.class))).thenReturn(otherAttributeAppender);
  when(extendingInstrumentation.prepare(any(InstrumentedType.class))).thenReturn(extendedInstrumentedType);
  when(extendingInstrumentation.appender(any(Instrumentation.Target.class))).thenReturn(simpleByteCodeAppender);
  when(basicInstrumentedType.detach()).thenReturn(basicInstrumentedType);
  when(extendedInstrumentedType.detach()).thenReturn(extendedInstrumentedType);
  when(basicInstrumentedType.getLoadedTypeInitializer()).thenReturn(loadedTypeInitializer);
  when(extendedInstrumentedType.getLoadedTypeInitializer()).thenReturn(loadedTypeInitializer);
  when(basicInstrumentedType.getTypeInitializer()).thenReturn(typeInitializer);
  when(extendedInstrumentedType.getTypeInitializer()).thenReturn(typeInitializer);
}
