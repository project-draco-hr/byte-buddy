{
  MethodRegistry.Compiled compiled=new MethodRegistry.Default().prepend(latentMatchesKnownMethod,otherInstrumentation,otherAttributeAppenderFactory).prepend(latentMatchesKnownMethod,simpleInstrumentation,simpleAttributeAppenderFactory).prepare(basicInstrumentedType).compile(instrumentationTargetFactory,methodLookupEngine,fallbackFactory);
  assertThat(compiled.target(knownMethod).isDefineMethod(),is(true));
  assertThat(compiled.target(knownMethod).getAttributeAppender(),is(simpleAttributeAppender));
  assertThat(compiled.target(knownMethod).getByteCodeAppender(),is(simpleByteCodeAppender));
  assertThat(compiled.target(unknownMethod),is(fallback));
  verify(simpleInstrumentation).prepare(basicInstrumentedType);
  verify(simpleInstrumentation).appender(basicInstrumentationTarget);
  verify(simpleAttributeAppenderFactory).make(basicInstrumentedType);
  verifyNoMoreInteractions(simpleInstrumentation);
  verifyNoMoreInteractions(simpleAttributeAppenderFactory);
  verify(otherInstrumentation).prepare(basicInstrumentedType);
  verify(otherInstrumentation).appender(basicInstrumentationTarget);
  verify(otherAttributeAppenderFactory).make(basicInstrumentedType);
  verifyNoMoreInteractions(otherInstrumentation);
  verifyNoMoreInteractions(otherAttributeAppenderFactory);
  verify(fallbackFactory).compile(basicInstrumentationTarget);
  verifyNoMoreInteractions(fallbackFactory);
}
