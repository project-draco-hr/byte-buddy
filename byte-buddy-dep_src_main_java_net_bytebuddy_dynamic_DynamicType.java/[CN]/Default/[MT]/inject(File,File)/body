{
  JarInputStream jarInputStream=new JarInputStream(new BufferedInputStream(new FileInputStream(sourceJar)));
  try {
    if (!targetJar.createNewFile()) {
      Logger.getAnonymousLogger().info("Overwriting file " + targetJar);
    }
    JarOutputStream jarOutputStream=new JarOutputStream(new BufferedOutputStream(new FileOutputStream(targetJar)),jarInputStream.getManifest());
    try {
      Map<TypeDescription,byte[]> rawAuxiliaryTypes=getAuxiliaryTypes();
      Map<String,byte[]> files=new HashMap<String,byte[]>(rawAuxiliaryTypes.size() + 1);
      for (      Map.Entry<TypeDescription,byte[]> entry : rawAuxiliaryTypes.entrySet()) {
        files.put(entry.getKey().getInternalName() + CLASS_FILE_EXTENSION,entry.getValue());
      }
      files.put(typeDescription.getInternalName() + CLASS_FILE_EXTENSION,binaryRepresentation);
      JarEntry jarEntry;
      while ((jarEntry=jarInputStream.getNextJarEntry()) != null) {
        jarOutputStream.putNextEntry(jarEntry);
        byte[] replacement=files.remove(jarEntry.getName());
        if (replacement == null) {
          byte[] buffer=new byte[BUFFER_SIZE];
          int index;
          while ((index=jarInputStream.read(buffer)) != END_OF_FILE) {
            jarOutputStream.write(buffer,FROM_BEGINNING,index);
          }
        }
 else {
          jarOutputStream.write(replacement);
        }
        jarInputStream.closeEntry();
        jarOutputStream.closeEntry();
      }
      for (      Map.Entry<String,byte[]> entry : files.entrySet()) {
        jarOutputStream.putNextEntry(new JarEntry(entry.getKey()));
        jarOutputStream.write(entry.getValue());
        jarOutputStream.closeEntry();
      }
    }
  finally {
      jarOutputStream.close();
    }
  }
  finally {
    jarInputStream.close();
  }
  return targetJar;
}
