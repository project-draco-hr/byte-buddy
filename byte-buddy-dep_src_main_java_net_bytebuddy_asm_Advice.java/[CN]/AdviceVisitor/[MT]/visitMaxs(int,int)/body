{
  onUserEnd();
  mv.visitLabel(endOfMethod);
  metaDataHandler.injectCompletionFrame(mv,false);
  append(methodExit);
  variable(Opcodes.ALOAD,instrumentedMethod.getReturnType().getStackSize().getSize());
  Label exceptionalReturn=new Label();
  mv.visitJumpInsn(Opcodes.IFNONNULL,exceptionalReturn);
  if (instrumentedMethod.getReturnType().represents(void.class)) {
    mv.visitInsn(Opcodes.RETURN);
  }
 else {
    Type returnType=Type.getType(instrumentedMethod.getReturnType().asErasure().getDescriptor());
    variable(returnType.getOpcode(Opcodes.ILOAD));
    mv.visitInsn(returnType.getOpcode(Opcodes.IRETURN));
  }
  mv.visitLabel(exceptionalReturn);
  metaDataHandler.injectCompletionFrame(mv,true);
  variable(Opcodes.ALOAD,instrumentedMethod.getReturnType().getStackSize().getSize());
  mv.visitInsn(Opcodes.ATHROW);
  super.visitMaxs(metaDataHandler.compoundStackSize(maxStack),metaDataHandler.compoundLocalVariableSize(maxLocals));
}
