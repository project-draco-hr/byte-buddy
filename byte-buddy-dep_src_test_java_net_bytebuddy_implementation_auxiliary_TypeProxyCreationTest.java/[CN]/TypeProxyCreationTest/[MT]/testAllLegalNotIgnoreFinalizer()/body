{
  when(implementationTarget.getTypeDescription()).thenReturn(foo);
  when(invocationFactory.invoke(eq(implementationTarget),eq(foo),any(MethodDescription.class))).thenReturn(specialMethodInvocation);
  when(specialMethodInvocation.isValid()).thenReturn(true);
  when(specialMethodInvocation.apply(any(MethodVisitor.class),any(Implementation.Context.class))).thenReturn(new StackManipulation.Size(0,0));
  when(methodAccessorFactory.registerAccessorFor(specialMethodInvocation)).thenReturn(proxyMethod);
  TypeDescription dynamicType=new TypeProxy(foo,implementationTarget,invocationFactory,false,false).make(BAR,ClassFileVersion.forCurrentJavaVersion(),methodAccessorFactory).getTypeDescription();
  assertThat(dynamicType.getModifiers(),is(modifiers));
  assertThat(dynamicType.getSuperType(),is(foo));
  assertThat(dynamicType.getInterfaces(),is((TypeList)new TypeList.Empty()));
  assertThat(dynamicType.getName(),is(BAR));
  assertThat(dynamicType.getDeclaredMethods().size(),is(2));
  assertThat(dynamicType.isAssignableTo(Serializable.class),is(false));
  verify(methodAccessorFactory,times(fooMethods.size() + 1)).registerAccessorFor(specialMethodInvocation);
  for (  MethodDescription methodDescription : fooMethods) {
    verify(invocationFactory).invoke(implementationTarget,foo,methodDescription);
  }
  verify(invocationFactory).invoke(implementationTarget,foo,new MethodDescription.ForLoadedMethod(Object.class.getDeclaredMethod("finalize")));
  verifyNoMoreInteractions(invocationFactory);
  verify(specialMethodInvocation,times(fooMethods.size() + 1)).isValid();
  verifyNoMoreInteractions(specialMethodInvocation);
}
