{
  when(dynamicType.getBytes()).thenReturn(BAZ);
  RuntimeException exception=mock(RuntimeException.class);
  when(resolution.resolve()).thenThrow(exception);
  when(rawMatcher.matches(new TypeDescription.ForLoadedType(REDEFINED),REDEFINED.getClassLoader(),REDEFINED,REDEFINED.getProtectionDomain())).thenReturn(true);
  ClassFileTransformer classFileTransformer=new AgentBuilder.Default(byteBuddy).with(initializationStrategy).with(typeLocator).with(typeStrategy).with(listener).disableNativeMethodPrefix().with(accessControlContext).type(rawMatcher).transform(transformer).installOn(instrumentation);
  assertThat(classFileTransformer.transform(REDEFINED.getClassLoader(),REDEFINED.getName(),null,REDEFINED.getProtectionDomain(),QUX),nullValue(byte[].class));
  verify(listener).onError(REDEFINED.getName(),REDEFINED.getClassLoader(),exception);
  verify(listener).onComplete(REDEFINED.getName(),REDEFINED.getClassLoader());
  verifyNoMoreInteractions(listener);
  verify(instrumentation).addTransformer(classFileTransformer,false);
  verifyNoMoreInteractions(instrumentation);
  verifyZeroInteractions(initializationStrategy);
}
