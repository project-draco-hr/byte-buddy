{
  when(unloaded.getBytes()).thenReturn(BAZ);
  RuntimeException exception=mock(RuntimeException.class);
  when(resolution.resolve()).thenThrow(exception);
  when(rawMatcher.matches(typeDescription,classLoader,REDEFINED,protectionDomain)).thenReturn(true);
  ClassFileTransformer classFileTransformer=new AgentBuilder.Default(byteBuddy).disableSelfInitialization().withBinaryLocator(binaryLocator).withListener(listener).rebase(rawMatcher).transform(transformer).installOn(instrumentation);
  assertThat(instrumentations.size(),is(1));
  assertThat(instrumentations.get(0).transform(classLoader,FOO,REDEFINED,protectionDomain,QUX),nullValue(byte[].class));
  verify(listener).onError(FOO,exception);
  verify(listener).onComplete(FOO);
  verifyNoMoreInteractions(listener);
  verify(instrumentation).addTransformer(classFileTransformer,false);
  verifyNoMoreInteractions(instrumentation);
}
