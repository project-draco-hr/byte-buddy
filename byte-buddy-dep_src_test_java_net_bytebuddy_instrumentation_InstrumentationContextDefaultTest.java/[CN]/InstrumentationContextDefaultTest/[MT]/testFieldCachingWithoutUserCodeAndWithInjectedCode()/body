{
  when(byteCodeAppender.appendsCode()).thenReturn(true);
  when(injectedCode.isInjected()).thenReturn(true);
  Instrumentation.Context.ExtractableView instrumentationContext=new Instrumentation.Context.Default(instrumentedType,classFileVersion);
  FieldDescription firstField=instrumentationContext.cache(firstFieldValue,firstFieldType);
  assertThat(instrumentationContext.cache(firstFieldValue,firstFieldType),is(firstField));
  FieldDescription secondField=instrumentationContext.cache(secondFieldValue,secondFieldType);
  assertThat(instrumentationContext.cache(firstFieldValue,firstFieldType),is(firstField));
  assertThat(instrumentationContext.cache(secondFieldValue,secondFieldType),is(secondField));
  instrumentationContext.drain(classVisitor,methodPool,injectedCode);
  verify(classVisitor).visitField(eq(Instrumentation.Context.ExtractableView.FIELD_CACHE_MODIFIER),any(String.class),eq(BAR),isNull(String.class),isNull());
  verify(classVisitor).visitField(eq(Instrumentation.Context.ExtractableView.FIELD_CACHE_MODIFIER),any(String.class),eq(QUX),isNull(String.class),isNull());
  verify(classVisitor).visitMethod(eq(Opcodes.ACC_STATIC),eq(MethodDescription.TYPE_INITIALIZER_INTERNAL_NAME),eq("()V"),isNull(String.class),isNull(String[].class));
  verifyNoMoreInteractions(classVisitor);
  verify(methodVisitor).visitCode();
  verify(firstFieldValue).apply(methodVisitor,instrumentationContext);
  verify(methodVisitor).visitFieldInsn(eq(Opcodes.PUTSTATIC),eq(BAZ),any(String.class),eq(BAR));
  verify(secondFieldValue).apply(methodVisitor,instrumentationContext);
  verify(methodVisitor).visitFieldInsn(eq(Opcodes.PUTSTATIC),eq(BAZ),any(String.class),eq(QUX));
  verify(injectedCode).isInjected();
  verify(injectedCode).getInjectedCode();
  verify(injectedCodeAppender).apply(methodVisitor,instrumentationContext);
  verifyNoMoreInteractions(injectedCode);
  verify(entry).isDefineMethod();
  verify(methodVisitor).visitInsn(Opcodes.RETURN);
  verify(methodVisitor).visitMaxs(0,0);
  verify(methodVisitor).visitEnd();
  verifyNoMoreInteractions(methodVisitor);
  verifyNoMoreInteractions(firstFieldValue);
  verifyNoMoreInteractions(secondFieldValue);
  verify(methodPool).target(MethodDescription.Latent.typeInitializerOf(instrumentedType));
  verifyNoMoreInteractions(methodPool);
  verifyZeroInteractions(attributeAppender);
  verifyZeroInteractions(byteCodeAppender);
}
