{
  ClassFileTransformer classFileTransformer=new AgentBuilder.Default().disableSelfInitialization().withNativeMethodPrefix(QUX).rebase(isAnnotatedWith(ShouldRebase.class)).transform(new FooTransformer()).installOnByteBuddyAgent();
  try {
    assertThat(new Foo().foo(),is(BAR));
    assertThat(Foo.class.getDeclaredMethod(QUX + FOO),notNullValue(Method.class));
  }
  finally {
    ByteBuddyAgent.getInstrumentation().removeTransformer(classFileTransformer);
  }
}
